<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Timer RPA Local</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-header h1 {
            color: #1e3c72;
            margin: 0 0 10px 0;
        }

        .test-header p {
            color: #666;
            margin: 0;
        }

        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .test-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .test-btn.success { background: #28a745; }
        .test-btn.error { background: #dc3545; }
        .test-btn.manual { background: #ffc107; color: #333; }
        .test-btn.timeout { background: #6c757d; }

        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-warning { color: #ffc107; }
        .log-info { color: #17a2b8; }

        /* Timer sobreposto - sem modal */
        .timer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: none; /* ‚Üê COMPLETAMENTE INVIS√çVEL */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: 'Inter', sans-serif;
            pointer-events: none; /* ‚Üê N√ÉO INTERFERE COM CLICKS */
        }

        .timer-content {
            background: none; /* ‚Üê SEM FUNDO */
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            width: 40vw; /* ‚Üê 40% DA LARGURA DA VIEWPORT */
            max-width: 40vw; /* ‚Üê LIMITA O TAMANHO M√ÅXIMO */
            /* Removido box-shadow e border */
        }

        .modal-header {
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e3c72;
            margin: 0 0 10px 0;
        }

        .modal-subtitle {
            font-size: 16px;
            color: #666;
            margin: 0;
        }

        .spinner-timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }

        .spinner-container {
            position: relative;
            width: 120px; /* ‚Üê MAIOR */
            height: 120px; /* ‚Üê MAIOR */
            margin-bottom: 20px;
        }

        .sk-circle {
            width: 120px; /* ‚Üê MAIOR */
            height: 120px; /* ‚Üê MAIOR */
            position: relative;
        }

        .sk-circle .sk-child {
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }

        .sk-circle .sk-child:before {
            content: '';
            display: block;
            margin: 0 auto;
            width: 15%;
            height: 15%;
            background-color: #dc3545; /* ‚Üê VERMELHO */
            border-radius: 100%;
            animation: sk-circleBounceDelay 1.2s infinite ease-in-out both;
        }

        .sk-circle .sk-child:nth-child(1) { transform: rotate(30deg); }
        .sk-circle .sk-child:nth-child(2) { transform: rotate(60deg); }
        .sk-circle .sk-child:nth-child(3) { transform: rotate(90deg); }
        .sk-circle .sk-child:nth-child(4) { transform: rotate(120deg); }
        .sk-circle .sk-child:nth-child(5) { transform: rotate(150deg); }
        .sk-circle .sk-child:nth-child(6) { transform: rotate(180deg); }
        .sk-circle .sk-child:nth-child(7) { transform: rotate(210deg); }
        .sk-circle .sk-child:nth-child(8) { transform: rotate(240deg); }
        .sk-circle .sk-child:nth-child(9) { transform: rotate(270deg); }
        .sk-circle .sk-child:nth-child(10) { transform: rotate(300deg); }
        .sk-circle .sk-child:nth-child(11) { transform: rotate(330deg); }
        .sk-circle .sk-child:nth-child(12) { transform: rotate(360deg); }

        .sk-circle .sk-child:nth-child(1):before { animation-delay: -1.1s; }
        .sk-circle .sk-child:nth-child(2):before { animation-delay: -1.0s; }
        .sk-circle .sk-child:nth-child(3):before { animation-delay: -0.9s; }
        .sk-circle .sk-child:nth-child(4):before { animation-delay: -0.8s; }
        .sk-circle .sk-child:nth-child(5):before { animation-delay: -0.7s; }
        .sk-circle .sk-child:nth-child(6):before { animation-delay: -0.6s; }
        .sk-circle .sk-child:nth-child(7):before { animation-delay: -0.5s; }
        .sk-circle .sk-child:nth-child(8):before { animation-delay: -0.4s; }
        .sk-circle .sk-child:nth-child(9):before { animation-delay: -0.3s; }
        .sk-circle .sk-child:nth-child(10):before { animation-delay: -0.2s; }
        .sk-circle .sk-child:nth-child(11):before { animation-delay: -0.1s; }
        .sk-circle .sk-child:nth-child(12):before { animation-delay: 0s; }

        @keyframes sk-circleBounceDelay {
            0%, 80%, 100% {
                transform: scale(0);
            } 40% {
                transform: scale(1);
            }
        }

        .spinner-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px; /* ‚Üê MAIOR */
            font-weight: bold;
            color: #dc3545; /* ‚Üê VERMELHO */
            z-index: 10;
        }

        .timer-message {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }

        .modal-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .modal-footer p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ Teste Timer RPA Local</h1>
            <p>Teste o comportamento do timer sem chamar a API real</p>
        </div>

        <div class="test-buttons">
            <button class="test-btn success" onclick="testSuccess()">
                ‚úÖ Teste Sucesso
            </button>
            <button class="test-btn error" onclick="testError()">
                ‚ùå Teste Erro
            </button>
            <button class="test-btn manual" onclick="testManual()">
                üéØ Teste Manual
            </button>
            <button class="test-btn timeout" onclick="testTimeout()">
                ‚è∞ Teste Timeout
            </button>
        </div>

        <div class="test-log" id="testLog">
            <div class="log-entry log-info">üöÄ Ambiente de teste carregado</div>
            <div class="log-entry log-info">üìù Clique em um bot√£o para testar o timer</div>
        </div>
    </div>

    <!-- Timer sobreposto - sem modal -->
    <div id="testTimer" class="timer-overlay" style="display: none;">
        <div class="timer-content">
            <div class="spinner-timer-container" id="spinnerTimerContainer">
                <div class="spinner-container">
                    <div class="sk-circle">
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                        <div class="sk-child"></div>
                    </div>
                    <div class="spinner-center" id="spinnerCenter">03:00</div>
                </div>
                <div class="timer-message" id="timerMessage"></div>
            </div>
        </div>
    </div>

    <script>
        // Simulador RPA Local
        class LocalRPASimulator {
            constructor() {
                this.sessionId = 'local_test_' + Date.now();
                this.currentStep = 0;
                this.totalSteps = 5;
                this.isRunning = false;
                this.timer = null;
                this.progressInterval = null;
            }

            log(message, type = 'info') {
                const logContainer = document.getElementById('testLog');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            async simulate(scenario) {
                this.log(`üé¨ Iniciando simula√ß√£o: ${scenario}`, 'info');
                this.isRunning = true;
                
                // Mostra o timer sobreposto
                document.getElementById('testTimer').style.display = 'flex';
                
                // Inicializa o timer
                this.initTimer();
                
                // Simula progresso
                this.simulateProgress(scenario);
            }

            initTimer() {
                this.log('‚è∞ Inicializando timer...', 'info');
                
                // Cria o timer
                this.timer = new SpinnerTimer();
                this.timer.init();
                this.timer.start(); // ‚Üê CORRE√á√ÉO: Adicionar start()
                
                this.log('‚úÖ Timer inicializado e iniciado', 'success');
            }

            simulateProgress(scenario) {
                this.log(`üìä Simulando progresso para: ${scenario}`, 'info');
                
                let step = 0;
                const maxSteps = 10; // ‚Üê AUMENTAR para 10 segundos
                
                this.progressInterval = setInterval(() => {
                    step++;
                    this.log(`üìà Progresso: ${step}/${maxSteps}`, 'info');
                    
                    if (step >= maxSteps) {
                        this.finishSimulation(scenario);
                    }
                }, 1000);
            }

            finishSimulation(scenario) {
                clearInterval(this.progressInterval);
                this.isRunning = false;
                
                this.log(`üèÅ Simula√ß√£o finalizada: ${scenario}`, 'success');
                
                // Para o timer
                if (this.timer) {
                    this.timer.finish();
                    this.log('‚èπÔ∏è Timer parado', 'info');
                }
                
                // Esconde o timer ap√≥s 2 segundos
                setTimeout(() => {
                    document.getElementById('testTimer').style.display = 'none';
                    this.log('üîí Timer escondido', 'info');
                }, 2000);
            }

            stop() {
                if (this.isRunning) {
                    clearInterval(this.progressInterval);
                    this.isRunning = false;
                    
                    if (this.timer) {
                        this.timer.finish();
                    }
                    
                    document.getElementById('testModal').style.display = 'none';
                    this.log('üõë Simula√ß√£o interrompida', 'warning');
                }
            }
        }

        // Classe SpinnerTimer (copiada do webflow-injection-complete.js)
        class SpinnerTimer {
            constructor() {
                this.totalSeconds = 180; // 3 minutos
                this.remainingSeconds = 180;
                this.isRunning = false;
                this.intervalId = null;
                this.extensionCount = 0;
                this.maxExtensions = 1;
            }

            init() {
                console.log('üîÑ SpinnerTimer.init() chamado');
                
                const spinnerCenter = document.getElementById('spinnerCenter');
                const timerMessage = document.getElementById('timerMessage');
                
                if (!spinnerCenter) {
                    console.error('‚ùå Elemento spinnerCenter n√£o encontrado');
                    return;
                }
                
                console.log('‚úÖ Elemento spinnerCenter encontrado:', spinnerCenter);
                
                this.updateDisplay();
                console.log('‚úÖ Display atualizado');
            }

            start() {
                console.log('‚ñ∂Ô∏è SpinnerTimer.start() chamado');
                
                if (this.isRunning) {
                    console.log('‚ö†Ô∏è Timer j√° est√° rodando');
                    return;
                }
                
                this.isRunning = true;
                this.intervalId = setInterval(() => {
                    this.tick();
                }, 1000);
                
                console.log('‚úÖ Timer iniciado - intervalo criado');
            }

            tick() {
                console.log(`‚è∞ Tick: ${this.remainingSeconds} segundos restantes`);
                this.remainingSeconds--;
                this.updateDisplay();
                
                if (this.remainingSeconds <= 0) {
                    this.handleTimeout();
                }
            }

            updateDisplay() {
                const spinnerCenter = document.getElementById('spinnerCenter');
                const timerMessage = document.getElementById('timerMessage');
                
                console.log(`üîÑ updateDisplay: ${this.remainingSeconds} segundos`);
                
                if (spinnerCenter) {
                    const minutes = Math.floor(this.remainingSeconds / 60);
                    const seconds = this.remainingSeconds % 60;
                    const displayText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    spinnerCenter.textContent = displayText;
                    console.log(`üì∫ Display atualizado para: ${displayText}`);
                }
                
                if (timerMessage) {
                    if (this.extensionCount > 0) {
                        timerMessage.textContent = 'Est√° demorando mais que o normal. Aguardando mais 2 minutos...';
                    } else {
                        timerMessage.textContent = '';
                    }
                }
            }

            handleTimeout() {
                if (this.extensionCount < this.maxExtensions) {
                    this.extensionCount++;
                    this.remainingSeconds = 120; // 2 minutos extras
                    this.updateDisplay();
                    console.log('‚è∞ Timer estendido por 2 minutos');
                } else {
                    this.finish();
                }
            }

            finish() {
                console.log('üèÅ SpinnerTimer.finish() chamado');
                
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
                
                this.isRunning = false;
                
                const spinnerCenter = document.getElementById('spinnerCenter');
                if (spinnerCenter) {
                    spinnerCenter.textContent = '00:00';
                }
                
                console.log('‚úÖ Timer finalizado');
            }

            stop() {
                console.log('‚èπÔ∏è SpinnerTimer.stop() chamado');
                this.finish();
            }
        }

        // Inst√¢ncia do simulador
        const simulator = new LocalRPASimulator();

        // Fun√ß√µes de teste
        function testSuccess() {
            simulator.log('üéØ Iniciando teste de sucesso', 'info');
            simulator.simulate('success');
        }

        function testError() {
            simulator.log('üéØ Iniciando teste de erro', 'info');
            simulator.simulate('error');
        }

        function testManual() {
            simulator.log('üéØ Iniciando teste de cota√ß√£o manual', 'info');
            simulator.simulate('manual');
        }

        function testTimeout() {
            simulator.log('üéØ Iniciando teste de timeout', 'info');
            simulator.simulate('timeout');
        }

        // Log inicial
        simulator.log('üöÄ Ambiente de teste carregado', 'success');
        simulator.log('üìù Clique em um bot√£o para testar o timer', 'info');
    </script>
</body>
</html>
