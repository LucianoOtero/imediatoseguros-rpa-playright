# üöÄ Imediato Seguros RPA - Playwright

## üéØ **RESUMO EXECUTIVO**

### **Projeto**: RPA T√¥ Segurado - Migra√ß√£o Selenium ‚Üí Playwright
### **Status**: ‚úÖ **RPA V6.7.5 IMPLEMENTADA - VERS√ÉO VISUAL FINAL PARA PRODU√á√ÉO**
### **Vers√£o**: v6.7.5 - Sistema RPA com Visual Profissional e Moderno
### **Resultado**: Sistema RPA V6.7.5 com interface moderna, sombra elegante, layout responsivo e visual profissional pronto para produ√ß√£o

---

## üèÜ **CONQUISTAS REALIZADAS**

### ‚úÖ **RPA V6.7.5 - VERS√ÉO VISUAL FINAL PARA PRODU√á√ÉO**
- **Status**: ‚úÖ **100% FUNCIONANDO - VISUAL PROFISSIONAL E MODERNO**
- **Arquitetura**: Modal completo com 2 cards (recomendado + alternativo) + 12 campos din√¢micos
- **Funcionalidade**: Sistema RPA executando perfeitamente todas as 16 fases (1-15 + finaliza√ß√£o)
- **Resultados Finais**: Planos recomendado e alternativo sendo capturados e exibidos corretamente
- **Valores Principais**: R$2.950,38 (recomendado) e R$4.387,32 (alternativo) sendo atualizados
- **Campos Din√¢micos**: 12 campos detalhados sendo populados automaticamente (forma de pagamento, franquia, coberturas, etc.)
- **Interface**: Modal responsivo com visual moderno, sombra elegante e layout profissional
- **√çcones**: Font Awesome funcionando corretamente (calculadora, estrela, escudo)
- **Performance**: Sistema est√°vel e testado com timeout de 3 minutos
- **Experi√™ncia**: Interface completa funcionando com progresso em tempo real
- **Layout**: Responsivo para desktop (2 colunas) e mobile (1 coluna)
- **C√≥digo**: JavaScript unificado funcionando perfeitamente
- **Conectividade**: URLs funcionando corretamente
- **Corre√ß√µes**: Vazamento de estilos eliminado, seletores JavaScript corrigidos
- **Isolamento**: CSS com escopo completo (#rpaModal), sem interfer√™ncia na p√°gina principal
- **Data Mapping**: Busca robusta em m√∫ltiplas estruturas JSON para garantir captura de dados
- **Formata√ß√£o**: Sistema de formata√ß√£o de moeda e checkmarks funcionando perfeitamente
- **Seguran√ßa**: HTTPS implementado com certificados SSL Let's Encrypt
- **Criptografia**: Todos os dados trafegam protegidos por TLS 1.2/1.3
- **Performance**: Mantida com HTTPS (<1s resposta)
- **Visual**: Interface moderna com sombra elegante, t√≠tulos e valores equilibrados, bot√£o 'X' profissional
- **Pr√≥xima Vers√£o**: Sistema completo e pronto para produ√ß√£o

---

## üîê **IMPLEMENTA√á√ÉO HTTPS V6.6.0**

### **‚úÖ SEGURAN√áA M√ÅXIMA IMPLEMENTADA**
- **HTTPS**: 100% funcional no servidor Hetzner (37.27.92.160)
- **Certificados**: SSL Let's Encrypt v√°lidos at√© 25/12/2025
- **Criptografia**: TLS 1.2/1.3 para prote√ß√£o total dos dados
- **Redirecionamento**: HTTP ‚Üí HTTPS autom√°tico (301 Moved Permanently)
- **Headers**: HSTS ativo para for√ßar HTTPS em todos os acessos

### **üß™ TESTES REALIZADOS E APROVADOS**
- **Health Check**: ‚úÖ API RPA funcionando via HTTPS
- **API Start**: ‚úÖ Sess√µes RPA criadas com sucesso via HTTPS
- **API Progress**: ‚úÖ Monitoramento em tempo real via HTTPS
- **Certificado SSL**: ‚úÖ V√°lido e confi√°vel
- **Performance**: ‚úÖ Mantida (<1s resposta com HTTPS)

### **üîß CORRE√á√ïES JAVASCRIPT**
- **apiBaseUrl**: Atualizado para `https://rpaimediatoseguros.com.br`
- **Chamadas API**: Todas as requisi√ß√µes agora usam HTTPS
- **Seguran√ßa**: Dados sens√≠veis protegidos por criptografia

---

## ‚úÖ **MELHORIAS IMPLEMENTADAS**

### **üéØ MODAL SIMPLIFICADO V6.2.2**
- **Decis√£o**: Remo√ß√£o do card de estimativa inicial do modal
- **Motivo**: Melhorar experi√™ncia do usu√°rio focando nos resultados finais
- **Resultado**: Interface mais limpa e direta
- **Layout**: Grid otimizado para 2 colunas (sem espa√ßos vazios)
- **Status**: Implementado e funcionando perfeitamente

### **‚úÖ FUNCIONALIDADES FUNCIONANDO PERFEITAMENTE**
- **Execu√ß√£o RPA**: Todas as 15 telas executando com sucesso
- **Captura de Dados**: Planos finais (recomendado e alternativo) sendo capturados
- **Progress Tracker**: Monitoramento em tempo real funcionando
- **Interface**: Modal simplificado com 2 cards funcionando
- **Responsividade**: Layout adaptativo para desktop e mobile
- **Conectividade**: APIs respondendo corretamente

---
- **Status**: ‚úÖ **100% CONCLU√çDO**
- **Telas implementadas**: 1-15 (todas)
- **Funcionalidades cr√≠ticas**: 100% migradas
- **Performance**: Superior ao Selenium original
- **Estabilidade**: Excelente

### ‚úÖ **SISTEMA DE NAVEGA√á√ÉO ROBUSTO**
- **Navega√ß√£o autom√°tica**: Todas as telas funcionando
- **Tratamento de acentua√ß√£o**: Implementado
- **Case-sensitivity**: Resolvido
- **Timeouts**: Otimizados
- **Fallbacks**: Implementados

### ‚úÖ **CAPTURA DE DADOS AVAN√áADA**
- **Valores dos planos**: Capturados corretamente
- **Parcelamento**: Implementado
- **Coberturas**: Detectadas automaticamente
- **Estrutura JSON**: Padronizada
- **Logs detalhados**: Implementados

### ‚úÖ **CORRE√á√ïES DE REGRESS√ïES**
- **Tela 9**: Corrigida (Estado Civil, Email, Celular)
- **Tela 10**: Corrigida (navega√ß√£o e dados)
- **Telas 11-15**: Implementadas com sucesso
- **Sintaxe**: Corrigida e validada

### ‚úÖ **SUPORTE A TIPO DE VE√çCULO (v3.3.0)**
- **Carros e Motos**: Suporte completo implementado
- **Seletores espec√≠ficos**: Para cada tipo de ve√≠culo
- **Valida√ß√£o de dom√≠nio**: `carro` ou `moto` apenas
- **Tratamento condicional**: Campo `kit_gas` ignorado para motos
- **Compatibilidade**: Total com vers√µes anteriores

### ‚úÖ **SISTEMA RPA V3 COM EXECU√á√ÉO EM BACKGROUND (v3.8.0)**
- **Execu√ß√£o em background**: Via systemd para gerenciamento robusto
- **API REST completa**: executar_rpa_v3.php com endpoints funcionais
- **Monitoramento em tempo real**: JSON progressivo por tela
- **M√∫ltiplas sess√µes**: Execu√ß√µes simult√¢neas isoladas
- **Scripts de controle**: start, monitor e cleanup automatizados
- **Health checks**: Verifica√ß√£o autom√°tica de depend√™ncias
- **Logs estruturados**: Sistema completo por sess√£o
- **Testado no Hetzner**: Validado em ambiente de produ√ß√£o

### ‚úÖ **PROGRESSTRACKER COM ESTIMATIVAS DA TELA 5 (v3.5.1)**
- **ProgressTracker integrado**: Diretamente em `navegar_tela_5_playwright()`
- **Estimativas em tempo real**: Dados da Tela 5 transmitidos instantaneamente
- **Deduplica√ß√£o inteligente**: 3 coberturas √∫nicas (CompreensivaDe, Roubo, RCFDe)
- **Arquivo JSON populado**: Estimativas salvas em `rpa_data/progress_*.json`
- **Arquitetura simplificada**: 69 linhas removidas (wrapper desnecess√°rio)
- **Backend Redis e JSON**: Ambos suportam estimativas da Tela 5
- **Interface unificada**: Detec√ß√£o autom√°tica de backend
- **Session management**: Suporte a execu√ß√µes concorrentes

### ‚úÖ **DETEC√á√ÉO DE COTA√á√ÉO MANUAL (v3.4.0)**
- **Detec√ß√£o autom√°tica**: Quando n√£o h√° cota√ß√£o autom√°tica
- **Wait condicional**: Ap√≥s modal de login
- **Captura de dados**: Para an√°lise manual pelo corretor
- **Retorno espec√≠fico**: `status: cotacao_manual`
- **Arquivo JSON**: Dados salvos para an√°lise

---

## üöÄ **INSTALA√á√ÉO E CONFIGURA√á√ÉO**

### **Pr√©-requisitos**
```bash
# Python 3.8+
python --version

# Node.js (para Playwright)
node --version
```

### **Instala√ß√£o**
```bash
# Clone o reposit√≥rio
git clone https://github.com/LucianoOtero/imediatoseguros-rpa-playright.git
cd imediatoseguros-rpa-playwright

# Instale as depend√™ncias Python
pip install -r requirements.txt

# Instale os navegadores do Playwright
playwright install
```

### **Configura√ß√£o**
```bash
# Configure os par√¢metros no arquivo
config/parametros.json

# Exemplo de configura√ß√£o:
{
  "placa": "EED-3D56",
  "nome": "Jo√£o Silva",
  "cpf": "123.456.789-00",
  "data_nascimento": "01/01/1990",
  "email": "joao@email.com",
  "celular": "(11) 99999-9999"
}
```

---

## üì± **EXECU√á√ÉO**

### **Execu√ß√£o Completa**
```bash
# Execute o RPA completo
python executar_rpa_imediato_playwright.py
```

### **Execu√ß√£o de Testes**
```bash
# Execute testes espec√≠ficos
python teste_tela_1_a_15_sequencial.py
```

### **Resultados**
- **Arquivo de sa√≠da**: `dados_planos_seguro_YYYYMMDD_HHMMSS.json`
- **Logs**: Console em tempo real
- **Screenshots**: Capturados automaticamente em caso de erro

---

## üìä **FUNCIONALIDADES IMPLEMENTADAS**

### **‚úÖ Sistema de Retorno Estruturado (NOVO)**
- ‚úÖ **C√≥digos de retorno padronizados** (9001-9999)
- ‚úÖ **Estrutura JSON consistente** com status, c√≥digo, mensagem
- ‚úÖ **Valida√ß√£o autom√°tica** de retornos
- ‚úÖ **Convers√£o de formatos antigos** para novo padr√£o
- ‚úÖ **Logs estruturados** com timestamps precisos

### **‚úÖ TELA ZERO KM (CONDICIONAL) - NOVO**
- ‚úÖ **Detec√ß√£o autom√°tica** ap√≥s Tela 5
- ‚úÖ **Sele√ß√£o inteligente** baseada no par√¢metro `zero_km`
- ‚úÖ **Transi√ß√£o suave** para Tela 6
- ‚úÖ **Tratamento de ambiguidade** de seletores
- ‚úÖ **Suporte para carros e motos**

### **‚úÖ DETEC√á√ÉO DE COTA√á√ÉO MANUAL (v3.4.0) - NOVO**
- ‚úÖ **Detec√ß√£o autom√°tica** quando n√£o h√° cota√ß√£o autom√°tica
- ‚úÖ **Wait condicional** ap√≥s modal de login
- ‚úÖ **Captura de dados** para an√°lise manual pelo corretor
- ‚úÖ **Retorno espec√≠fico** (`status: cotacao_manual`)
- ‚úÖ **Arquivo JSON** com dados coletados
- ‚úÖ **Logs detalhados** para monitoramento

### **Telas Implementadas (16/16)**
- ‚úÖ **Tela 1**: Sele√ß√£o do Tipo de Seguro (Carro/Moto)
- ‚úÖ **Tela 2**: Inser√ß√£o da Placa
- ‚úÖ **Tela 3**: Dados do Ve√≠culo
- ‚úÖ **Tela 4**: Dados do Propriet√°rio
- ‚úÖ **Tela 5**: Carrossel de Estimativas
- ‚úÖ **Tela Zero KM**: Detec√ß√£o Condicional
- ‚úÖ **Tela 6**: Sele√ß√£o de Coberturas (Kit Gas condicional)
- ‚úÖ **Tela 7**: Dados do Condutor
- ‚úÖ **Tela 8**: Dados do Condutor (Continua√ß√£o)
- ‚úÖ **Tela 9**: Dados Pessoais
- ‚úÖ **Tela 10**: Dados do Ve√≠culo (Continua√ß√£o)
- ‚úÖ **Tela 11**: Dados do Ve√≠culo (Finaliza√ß√£o)
- ‚úÖ **Tela 12**: Confirma√ß√£o de Dados
- ‚úÖ **Tela 13**: Sele√ß√£o de Plano
- ‚úÖ **Tela 14**: Dados de Pagamento (Condicional)
- ‚úÖ **Tela 15**: Captura de Dados dos Planos

### **Captura de Dados**
- ‚úÖ **Valores dos planos** (R$2.401,53, R$3.122,52)
- ‚úÖ **Parcelamento** (12x sem juros, 1x sem juros)
- ‚úÖ **Coberturas** (Assist√™ncia, Vidros, Carro Reserva)
- ‚úÖ **Valores de danos** (Materiais, Corporais, Morais)
- ‚úÖ **Tipo de franquia** (Normal, Reduzida)
- ‚úÖ **Tipo de ve√≠culo** (Carro, Moto) - NOVO
- ‚úÖ **Cota√ß√£o manual** (Dados para an√°lise) - NOVO
- ‚úÖ **Estrutura JSON** padronizada

---

## üìÅ **ESTRUTURA DO PROJETO**

```
imediatoseguros-rpa-playwright/
‚îú‚îÄ‚îÄ üìÅ rpa-v4/                               # RPA V4 - Arquitetura Modular
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ src/                              # C√≥digo fonte modular
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Controllers/                  # Controladores API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Services/                     # Servi√ßos de neg√≥cio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Repositories/                 # Persist√™ncia de dados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ Interfaces/                   # Contratos de interface
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ public/                           # API e Dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.php                     # Endpoint principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ dashboard.html                # Dashboard web
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ js/                           # JavaScript do dashboard
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ config/                           # Configura√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ tests/                            # Testes automatizados
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ deploy.sh                         # Deploy automatizado
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ README.md                         # Documenta√ß√£o V4
‚îú‚îÄ‚îÄ üìÑ executar_rpa_v3.php                   # RPA V3 - Sistema atual
‚îú‚îÄ‚îÄ üìÑ get_progress_completo.php             # Monitoramento V3
‚îú‚îÄ‚îÄ üìÑ parametros.json                       # Configura√ß√µes V3
‚îú‚îÄ‚îÄ üìÑ executar_rpa_imediato_playwright.py  # Script principal Python
‚îú‚îÄ‚îÄ üìÅ utils/                                # Utilit√°rios Python
‚îú‚îÄ‚îÄ üìÅ scripts/                              # Scripts de controle
‚îú‚îÄ‚îÄ üìÅ docs/                                 # Documenta√ß√£o
‚îú‚îÄ‚îÄ üìÅ logs/                                 # Logs de execu√ß√£o
‚îú‚îÄ‚îÄ üìÅ screenshots/                          # Screenshots de debug
‚îú‚îÄ‚îÄ üìÅ temp/                                 # Arquivos tempor√°rios
‚îú‚îÄ‚îÄ üìÑ requirements.txt                      # Depend√™ncias Python
‚îú‚îÄ‚îÄ üìÑ README.md                             # Este arquivo
‚îî‚îÄ‚îÄ üìÑ CHANGELOG.md                          # Hist√≥rico de vers√µes
```

---

## üîß **CONFIGURA√á√ÉO AVAN√áADA**

### **Par√¢metros de Configura√ß√£o**
```json
{
  "configuracao": {
    "log": true,
    "display": true,
    "log_rotacao_dias": 90,
    "log_nivel": "INFO",
    "tempo_estabilizacao": 1,
    "tempo_carregamento": 10,
    "inserir_log": true,
    "visualizar_mensagens": true,
    "eliminar_tentativas_inuteis": true
  }
}
```

### **Configura√ß√£o do Browser**
```python
# Configura√ß√µes padr√£o do Playwright
browser = playwright.chromium.launch(headless=False)
context = browser.new_context(
    viewport={'width': 1139, 'height': 1378},
    user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
)
```

---

## üìä **M√âTRICAS DE PERFORMANCE**

### **Tempos de Execu√ß√£o**
- **Tela 1**: ~3s
- **Tela 2**: ~6s
- **Tela 3**: ~3s
- **Tela 4**: ~3s
- **Tela 5**: ~30s (incluindo captura)
- **Tela 6**: ~3s
- **Tela 7**: ~3s
- **Tela 8**: ~3s
- **Tela 9**: ~3s
- **Tela 10**: ~3s
- **Tela 11**: ~3s
- **Tela 12**: ~3s
- **Tela 13**: ~3s
- **Tela 14**: ~3s (condicional)
- **Tela 15**: ~10s (captura de dados)
- **Total**: ~70s

### **Taxa de Sucesso**
- **Navega√ß√£o**: 100%
- **Captura de dados**: 100%
- **Parse de valores**: 100%
- **Estrutura√ß√£o JSON**: 100%

---

## üö® **COMPONENTES PENDENTES**

### **Prioridade Alta**
- üîÑ **Sistema de Retorno Estruturado**
- üìä **Sistema de Valida√ß√£o de Par√¢metros**

### **Prioridade M√©dia**
- üìù **Sistema de Logger Avan√ßado**
- üîÑ **Conversor Unicode ‚Üí ASCII**
- üìä **Sistema de Screenshots de Debug**
- üîÑ **Modo de Execu√ß√£o via Linha de Comando**

### **N√£o Implementar**
- üîß **Sistema de Helpers** (Espec√≠fico do Selenium)
- üìä **Captura de Dados da Tela 5** (J√° funcionando)

---

## üêõ **TROUBLESHOOTING**

### **Problemas Comuns**

#### **1. Elemento n√£o encontrado**
```bash
# Verificar se a p√°gina carregou completamente
# Aguardar mais tempo de carregamento
# Verificar seletor CSS
```

#### **2. Timeout de carregamento**
```bash
# Aumentar tempo de timeout
# Verificar conex√£o com internet
# Verificar se o site est√° acess√≠vel
```

#### **3. Dados n√£o capturados**
```bash
# Verificar estrutura da p√°gina
# Verificar seletores CSS
# Verificar logs de debug
```

### **Logs de Debug**
```bash
# Verificar logs em tempo real
# Verificar arquivo de log
# Verificar screenshots de erro
```

---

## üìà **ROADMAP**

## üìà **ROADMAP**

### **v3.4.0 (IMPLEMENTADO)**
- ‚úÖ Detec√ß√£o de Cota√ß√£o Manual
- ‚úÖ Wait Condicional ap√≥s Modal de Login
- ‚úÖ Captura de Dados para An√°lise Manual
- ‚úÖ Retorno Espec√≠fico (`status: cotacao_manual`)
- ‚úÖ Arquivo JSON com Dados Coletados

### **v3.3.0 (IMPLEMENTADO)**
- ‚úÖ Suporte a Tipo de Ve√≠culo (Carro/Moto)
- ‚úÖ Seletores Espec√≠ficos para Cada Tipo
- ‚úÖ Valida√ß√£o de Dom√≠nio (`carro` ou `moto`)
- ‚úÖ Tratamento Condicional do Campo `kit_gas`
- ‚úÖ Compatibilidade Total com Vers√µes Anteriores

### **v3.2.0 (IMPLEMENTADO)**
- ‚úÖ Tela Zero KM Condicional
- ‚úÖ Campo tipo_franquia na captura de dados
- ‚úÖ Detec√ß√£o autom√°tica de telas condicionais
- ‚úÖ Tratamento de ambiguidade de seletores

### **v3.1.0 (IMPLEMENTADO)**
- ‚úÖ Sistema de Retorno Estruturado
- ‚úÖ Teste Ponta-a-Ponta Completo
- ‚úÖ Valida√ß√£o e Estrutura JSON Padronizada

### **v3.5.1 (IMPLEMENTADO)**
- ‚úÖ ProgressTracker com Estimativas da Tela 5
- ‚úÖ Deduplica√ß√£o Inteligente de Coberturas
- ‚úÖ Arquitetura Simplificada
- ‚úÖ Backend Redis e JSON Suportam Estimativas
- ‚úÖ Interface Unificada com Detec√ß√£o Autom√°tica
- ‚úÖ Session Management para Execu√ß√µes Concorrentes

### **v4.1.0 (PR√ìXIMA VERS√ÉO)**
- üîÑ **Monitoramento em tempo real**: Implementar endpoint `/api/rpa/progress/{session_id}`
- üìä **JSON din√¢mico**: Modificar chamada do RPA para receber JSON via linha de comando
- üîÑ **Migra√ß√£o RPA principal**: Consolidar RPA modular no arquivo principal
- üîß **Integra√ß√£o Webflow**: JavaScript para modal de monitoramento
- üîê **Valida√ß√£o robusta**: Reativar valida√ß√£o de entrada com regras aprimoradas
- üìä **Performance**: Otimiza√ß√µes de concorr√™ncia e cache

### **üìã Planos Registrados**
- **PLANO_PROJETO_RPA_V4_OBJETIVOS.md**: Objetivos detalhados para execu√ß√£o concorrente e integra√ß√£o Webflow
- **PLANO_PRODUCAO_RPA_V4.md**: Pr√≥ximos passos para produ√ß√£o (monitoramento, JSON din√¢mico, migra√ß√£o)
- **PROJETO_RPA_V4_INCREMENTAL.md**: Estrat√©gia incremental de implementa√ß√£o

---

## üèóÔ∏è **ARQUITETURA DA SOLU√á√ÉO RPA V4**

### **Vis√£o Geral**
Sistema RPA V4 para automa√ß√£o de cota√ß√£o de seguros no portal `app.tosegurado.com.br`, executando em background com monitoramento em tempo real via API REST.

### **Objetivo Principal**
Executar `executar_rpa_imediato_playwright.py` em sess√µes concorrentes em background, chamado via JSON de par√¢metros via linha de comando a partir de JavaScript no `segurosimediato.com.br` (Webflow), com monitoramento de progresso em tempo real.

### **Componentes da Arquitetura**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    WEBFLOW (Frontend)                      ‚îÇ
‚îÇ  segurosimediato.com.br                                     ‚îÇ
‚îÇ  - Formul√°rio de cota√ß√£o                                    ‚îÇ
‚îÇ  - Modal de progresso                                       ‚îÇ
‚îÇ  - JavaScript para chamadas API                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ HTTP/HTTPS
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    NGINX (Proxy Reverso)                   ‚îÇ
‚îÇ  Porta 80/443                                               ‚îÇ
‚îÇ  - SSL/TLS                                                  ‚îÇ
‚îÇ  - Load balancing                                           ‚îÇ
‚îÇ  - Static files                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PHP-FPM (Backend)                       ‚îÇ
‚îÇ  Porta 9000                                                 ‚îÇ
‚îÇ  - API REST V4                                              ‚îÇ
‚îÇ  - SessionService.php                                       ‚îÇ
‚îÇ  - get_progress_completo.php                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    RPA PYTHON (Automation)                 ‚îÇ
‚îÇ  executar_rpa_imediato_playwright.py                       ‚îÇ
‚îÇ  - 15 telas de automa√ß√£o                                    ‚îÇ
‚îÇ  - Playwright + Chromium                                    ‚îÇ
‚îÇ  - Progress tracker JSON                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **API REST V4**

#### **Endpoint: `POST /api/rpa/start`**
**Fun√ß√£o**: Criar nova sess√£o RPA e iniciar execu√ß√£o em background

**Request**:
```json
{
    "cpf": "12345678901",
    "nome": "Jo√£o Silva",
    "placa": "ABC1234",
    "cep": "01234567",
    "email": "joao@email.com",
    "telefone": "11999999999"
}
```

**Response**:
```json
{
    "success": true,
    "session_id": "rpa_v4_20251001_222340_28563ee9",
    "message": "Sess√£o RPA criada com sucesso",
    "timestamp": "2025-10-01T22:23:40Z"
}
```

#### **Endpoint: `GET /api/rpa/progress/{session_id}`**
**Fun√ß√£o**: Obter progresso em tempo real da execu√ß√£o RPA

**Response**:
```json
{
    "success": true,
    "progress": {
        "etapa_atual": 15,
        "total_etapas": 15,
        "percentual": 100,
        "status": "success",
        "estimativas": {
            "capturadas": true,
            "dados": {
                "plano_recomendado": "R$ 3.743,52",
                "plano_alternativo": "R$ 3.962,68"
            }
        },
        "resultados_finais": {
            "rpa_finalizado": true,
            "dados": {
                "valor_final": "R$ 3.743,52",
                "cobertura": "Completa"
            }
        }
    }
}
```

### **Fluxo de Execu√ß√£o**

#### **1. In√≠cio da Sess√£o**
```
Webflow ‚Üí POST /api/rpa/start ‚Üí SessionService.php ‚Üí Script Bash ‚Üí RPA Python
```

#### **2. Monitoramento**
```
Webflow ‚Üí GET /api/rpa/progress/{session_id} ‚Üí get_progress_completo.php ‚Üí JSON Response
```

#### **3. Progress Tracker**
```
RPA Python ‚Üí progress_{session_id}.json ‚Üí get_progress_completo.php ‚Üí Webflow
```

### **Estrutura de Diret√≥rios**

```
/opt/imediatoseguros-rpa/
‚îú‚îÄ‚îÄ executar_rpa_imediato_playwright.py    # RPA principal
‚îú‚îÄ‚îÄ parametros.json                        # Dados de teste
‚îú‚îÄ‚îÄ venv/                                  # Ambiente Python
‚îú‚îÄ‚îÄ logs/                                  # Logs de execu√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ rpa_v4_{session_id}.log
‚îú‚îÄ‚îÄ rpa_data/                              # Progress tracker
‚îÇ   ‚îú‚îÄ‚îÄ progress_{session_id}.json
‚îÇ   ‚îî‚îÄ‚îÄ history_{session_id}.json
‚îî‚îÄ‚îÄ sessions/                              # Sess√µes ativas
    ‚îî‚îÄ‚îÄ {session_id}/
        ‚îî‚îÄ‚îÄ status.json

/opt/imediatoseguros-rpa-v4/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ Services/
‚îÇ       ‚îî‚îÄ‚îÄ SessionService.php             # API de cria√ß√£o
‚îú‚îÄ‚îÄ get_progress_completo.php              # API de progresso
‚îî‚îÄ‚îÄ public/
    ‚îî‚îÄ‚îÄ api/
        ‚îî‚îÄ‚îÄ rpa/
            ‚îú‚îÄ‚îÄ start.php                  # Endpoint de in√≠cio
            ‚îî‚îÄ‚îÄ progress.php               # Endpoint de progresso
```

### **Configura√ß√£o de Produ√ß√£o**

#### **Servidor**
- **OS**: Ubuntu 22.04 LTS
- **CPU**: 2 vCPUs
- **RAM**: 4GB
- **Storage**: 40GB SSD
- **IP**: 37.27.92.160

#### **Servi√ßos**
- **Nginx**: 1.18.0 (Proxy reverso)
- **PHP-FPM**: 8.1 (Backend API)
- **Python**: 3.10 (RPA automation)
- **Playwright**: 1.40.0 (Browser automation)

#### **Permiss√µes**
```bash
# Diret√≥rios principais
chown -R www-data:www-data /opt/imediatoseguros-rpa/
chmod -R 755 /opt/imediatoseguros-rpa/

# Logs
chown -R www-data:www-data /opt/imediatoseguros-rpa/logs/
chmod -R 755 /opt/imediatoseguros-rpa/logs/

# Cache Playwright
mkdir -p /var/www/.cache
chown -R www-data:www-data /var/www/.cache
```

### **Integra√ß√£o Webflow**

#### **üéØ WEBHOOKS PARA BOT√ÉO "CALCULAR AGORA"**

Quando o bot√£o "Calcular agora" for clicado no website Webflow, o script JavaScript injetado deve disparar **4 webhooks obrigat√≥rios**:

##### **üìã WEBHOOKS EXISTENTES (MDMIDIA)**
- **Webhook 1**: `https://mdmidia.com.br/add_travelangels.php`
- **Webhook 2**: `https://mdmidia.com.br/add_webflow_octa.php`

##### **üöÄ WEBHOOKS RPA (NOVOS)**
- **Webhook 3**: `https://rpaimediatoseguros.com.br/api/rpa/start` (Iniciar RPA)
- **Webhook 4**: `https://rpaimediatoseguros.com.br/api/rpa/progress/{session_id}` (Monitorar RPA)

#### **üìã PADR√ÉO DE ENVIO DE PAR√ÇMETROS WEBFLOW**

##### **üîß ESTRUTURA PADR√ÉO DOS WEBHOOKS EXISTENTES**
Os webhooks existentes (`add_travelangels.php` e `add_webflow_octa.php`) esperam receber par√¢metros no formato padr√£o do Webflow:

```javascript
// Estrutura padr√£o dos dados do Webflow
const webflowData = {
    // Dados do formul√°rio
    name: "Nome do usu√°rio",
    email: "email@exemplo.com", 
    phone: "(11) 99999-9999",
    
    // Dados espec√≠ficos do formul√°rio de cota√ß√£o
    cpf: "123.456.789-00",
    placa: "ABC1234",
    cep: "01234-567",
    tipo_veiculo: "carro",
    
    // Metadados do Webflow
    form_name: "Formul√°rio de Cota√ß√£o",
    page_url: "https://segurosimediato.com.br/cotacao",
    timestamp: "2025-01-10T15:30:00Z",
    
    // Dados adicionais (se necess√°rio)
    utm_source: "google",
    utm_medium: "cpc",
    utm_campaign: "seguros"
};
```

##### **üì§ M√âTODOS DE ENVIO SUPORTADOS**
Os webhooks existentes suportam ambos os m√©todos:

**M√©todo GET (Par√¢metros na URL):**
```javascript
const sendWebhookGET = (url, data) => {
    const params = new URLSearchParams(data).toString();
    return fetch(`${url}?${params}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
    });
};
```

**M√©todo POST (JSON no Body):**
```javascript
const sendWebhookPOST = (url, data) => {
    return fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });
};
```

##### **üîó COMPATIBILIDADE COM WEBHOOKS EXISTENTES**
Para garantir que os webhooks existentes (`add_travelangels.php` e `add_webflow_octa.php`) continuem funcionando, o script JavaScript deve:

1. **Manter o formato de dados original** do Webflow
2. **Enviar dados em paralelo** para n√£o afetar a performance
3. **Tratar erros graciosamente** se algum webhook falhar
4. **Preservar a ordem de execu√ß√£o** (webhooks existentes primeiro, depois RPA)

```javascript
// Exemplo de implementa√ß√£o compat√≠vel
const sendExistingWebhooks = async (formData) => {
    const webflowData = {
        // Dados no formato esperado pelos webhooks existentes
        name: formData.nome,
        email: formData.email,
        phone: formData.telefone,
        cpf: formData.cpf,
        placa: formData.placa,
        cep: formData.cep,
        tipo_veiculo: formData.tipo_veiculo,
        form_name: "Formul√°rio de Cota√ß√£o",
        page_url: window.location.href,
        timestamp: new Date().toISOString()
    };
    
    // Enviar para ambos os webhooks existentes em paralelo
    const promises = [
        fetch('https://mdmidia.com.br/add_travelangels.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(webflowData)
        }),
        fetch('https://mdmidia.com.br/add_webflow_octa.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(webflowData)
        })
    ];
    
    try {
        const responses = await Promise.all(promises);
        return responses.every(response => response.ok);
    } catch (error) {
        console.warn('Erro nos webhooks existentes:', error);
        return false; // Continuar mesmo se falhar
    }
};
```

##### **1. üöÄ WEBHOOK DE IN√çCIO - Criar Sess√£o RPA**
```javascript
// Webhook 1: Iniciar processo RPA
const startRPA = async (formData) => {
    try {
        const response = await fetch('https://rpaimediatoseguros.com.br/api/rpa/start', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                cpf: formData.cpf,
                nome: formData.nome,
                placa: formData.placa,
                cep: formData.cep,
                email: formData.email,
                telefone: formData.telefone,
                tipo_veiculo: formData.tipo_veiculo || 'carro'
            })
        });

        const data = await response.json();
        if (data.success) {
            return data.session_id;
        } else {
            throw new Error(data.message || 'Erro ao iniciar RPA');
        }
    } catch (error) {
        console.error('Erro no webhook de in√≠cio:', error);
        throw error;
    }
};
```

##### **2. üìä WEBHOOK DE MONITORAMENTO - Acompanhar Progresso**
```javascript
// Webhook 2: Monitorar progresso em tempo real
const monitorProgress = async (sessionId) => {
    try {
        const progressResponse = await fetch(`https://rpaimediatoseguros.com.br/api/rpa/progress/${sessionId}`);
        const progressData = await progressResponse.json();
        
        if (progressData.success) {
            // Atualizar modal de progresso
            updateProgressModal(progressData.progress);
            
            // Verificar se processo foi conclu√≠do
            if (progressData.progress.status === 'success') {
                showFinalResults(progressData.progress.resultados_finais);
                return true; // Processo conclu√≠do
            }
            return false; // Processo em andamento
        } else {
            throw new Error(progressData.message || 'Erro ao obter progresso');
        }
    } catch (error) {
        console.error('Erro no webhook de monitoramento:', error);
        throw error;
    }
};
```

##### **üîÑ FLUXO COMPLETO DE EXECU√á√ÉO (4 WEBHOOKS)**
```javascript
// Fun√ß√£o principal executada no clique do bot√£o "Calcular agora"
const handleCalculateClick = async (formData) => {
    try {
        // 1. Preparar dados para todos os webhooks
        const webflowData = {
            // Dados do formul√°rio Webflow
            name: formData.nome,
            email: formData.email,
            phone: formData.telefone,
            cpf: formData.cpf,
            placa: formData.placa,
            cep: formData.cep,
            tipo_veiculo: formData.tipo_veiculo,
            
            // Metadados
            form_name: "Formul√°rio de Cota√ß√£o",
            page_url: window.location.href,
            timestamp: new Date().toISOString()
        };
        
        // 2. Disparar webhooks existentes (MDMIDIA)
        await Promise.all([
            sendWebhookPOST('https://mdmidia.com.br/add_travelangels.php', webflowData),
            sendWebhookPOST('https://mdmidia.com.br/add_webflow_octa.php', webflowData)
        ]);
        console.log('Webhooks MDMIDIA enviados com sucesso');
        
        // 3. Abrir modal de progresso RPA
        openProgressModal();
        
        // 4. Disparar webhook de in√≠cio RPA
        const sessionId = await startRPA(formData);
        console.log('Sess√£o RPA criada:', sessionId);
        
        // 5. Iniciar monitoramento RPA em tempo real
        const progressInterval = setInterval(async () => {
            try {
                const isComplete = await monitorProgress(sessionId);
                
                if (isComplete) {
                    clearInterval(progressInterval);
                    console.log('Processo RPA conclu√≠do com sucesso');
                }
            } catch (error) {
                clearInterval(progressInterval);
                showError('Erro no monitoramento: ' + error.message);
            }
        }, 2000); // Verificar a cada 2 segundos
        
        // 6. Timeout de seguran√ßa (3 minutos)
        setTimeout(() => {
            clearInterval(progressInterval);
            showTimeoutMessage();
        }, 180000); // 3 minutos
        
    } catch (error) {
        console.error('Erro na execu√ß√£o:', error);
        showError('Erro ao iniciar c√°lculo: ' + error.message);
    }
};
```

#### **üìã CONFIGURA√á√ÉO NO WEBFLOW**

##### **Estrutura do Formul√°rio**
```html
<!-- Formul√°rio de cota√ß√£o no Webflow -->
<form id="cotacaoForm">
    <input type="text" name="cpf" placeholder="CPF" required>
    <input type="text" name="nome" placeholder="Nome completo" required>
    <input type="text" name="placa" placeholder="Placa do ve√≠culo" required>
    <input type="text" name="cep" placeholder="CEP" required>
    <input type="email" name="email" placeholder="E-mail" required>
    <input type="tel" name="telefone" placeholder="Telefone" required>
    <select name="tipo_veiculo">
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
    </select>
    <button type="submit" id="calcularAgora">Calcular Agora</button>
</form>
```

##### **Event Listener no JavaScript**
```javascript
// Event listener para o bot√£o "Calcular agora"
document.getElementById('cotacaoForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Coletar dados do formul√°rio
    const formData = {
        cpf: document.querySelector('[name="cpf"]').value,
        nome: document.querySelector('[name="nome"]').value,
        placa: document.querySelector('[name="placa"]').value,
        cep: document.querySelector('[name="cep"]').value,
        email: document.querySelector('[name="email"]').value,
        telefone: document.querySelector('[name="telefone"]').value,
        tipo_veiculo: document.querySelector('[name="tipo_veiculo"]').value
    };
    
    // Executar fluxo completo
    await handleCalculateClick(formData);
});
```

#### **üîß JavaScript para Chamada da API (Vers√£o Completa - 4 Webhooks)**
```javascript
// Vers√£o completa do JavaScript para integra√ß√£o Webflow com 4 webhooks
const RPAIntegration = {
    // Configura√ß√µes
    config: {
        apiBaseUrl: 'https://rpaimediatoseguros.com.br',
        webhookUrls: {
            travelangels: 'https://mdmidia.com.br/add_travelangels.php',
            webflowOcta: 'https://mdmidia.com.br/add_webflow_octa.php',
            rpaStart: 'https://rpaimediatoseguros.com.br/api/rpa/start',
            rpaProgress: 'https://rpaimediatoseguros.com.br/api/rpa/progress'
        },
        pollingInterval: 2000, // 2 segundos
        maxPolls: 90, // 3 minutos (180 segundos)
        timeoutMessage: 'O c√°lculo est√° demorando mais que o esperado. Tente novamente em alguns minutos.'
    },
    
    // Webhook 1 & 2: Enviar para MDMIDIA
    async sendToMDMIDIA(webflowData) {
        const promises = [
            fetch(this.config.webhookUrls.travelangels, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(webflowData)
            }),
            fetch(this.config.webhookUrls.webflowOcta, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(webflowData)
            })
        ];
        
        const responses = await Promise.all(promises);
        return responses.every(response => response.ok);
    },
    
    // Webhook 3: Iniciar RPA
    async startRPA(formData) {
        const response = await fetch(this.config.webhookUrls.rpaStart, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        if (!data.success) {
            throw new Error(data.message || 'Erro ao iniciar RPA');
        }
        
        return data.session_id;
    },
    
    // Webhook 4: Monitorar progresso
    async getProgress(sessionId) {
        const response = await fetch(`${this.config.webhookUrls.rpaProgress}/${sessionId}`);
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.message || 'Erro ao obter progresso');
        }
        
        return data.progress;
    },
    
    // Fun√ß√£o principal com 4 webhooks
    async execute(formData) {
        try {
            // 1. Preparar dados para webhooks MDMIDIA
            const webflowData = {
                name: formData.nome,
                email: formData.email,
                phone: formData.telefone,
                cpf: formData.cpf,
                placa: formData.placa,
                cep: formData.cep,
                tipo_veiculo: formData.tipo_veiculo,
                form_name: "Formul√°rio de Cota√ß√£o",
                page_url: window.location.href,
                timestamp: new Date().toISOString()
            };
            
            // 2. Enviar para webhooks MDMIDIA (1 & 2)
            const mdmidiaSuccess = await this.sendToMDMIDIA(webflowData);
            if (!mdmidiaSuccess) {
                console.warn('Alguns webhooks MDMIDIA falharam, mas continuando...');
            }
            
            // 3. Abrir modal de progresso
            this.openProgressModal();
            
            // 4. Iniciar RPA (Webhook 3)
            const sessionId = await this.startRPA(formData);
            
            // 5. Monitorar progresso (Webhook 4)
            let pollCount = 0;
            const progressInterval = setInterval(async () => {
                try {
                    pollCount++;
                    const progress = await this.getProgress(sessionId);
                    
                    // Atualizar interface
                    this.updateProgressUI(progress);
                    
                    // Verificar conclus√£o
                    if (progress.status === 'success') {
                        clearInterval(progressInterval);
                        this.showResults(progress.resultados_finais);
                        return;
                    }
                    
                    // Verificar timeout
                    if (pollCount >= this.config.maxPolls) {
                        clearInterval(progressInterval);
                        this.showTimeout();
                    }
                    
                } catch (error) {
                    clearInterval(progressInterval);
                    this.showError('Erro no monitoramento: ' + error.message);
                }
            }, this.config.pollingInterval);
            
        } catch (error) {
            this.showError('Erro ao iniciar c√°lculo: ' + error.message);
        }
    },
    
    // M√©todos de interface (implementar conforme necess√°rio)
    openProgressModal() {
        // Abrir modal de progresso
    },
    
    updateProgressUI(progress) {
        // Atualizar barra de progresso, etapa atual, etc.
    },
    
    showResults(results) {
        // Exibir resultados finais
    },
    
    showError(message) {
        // Exibir erro
    },
    
    showTimeout() {
        // Exibir mensagem de timeout
    }
};
```

#### **Modal de Progresso**
- Barra de progresso (0-100%)
- Etapa atual (1-15)
- Estimativas iniciais (Tela 4)
- Resultados finais (Tela 15)
- Tratamento de erros

### **Status Atual**
**Sistema 100% funcional e pronto para produ√ß√£o**

#### **Valida√ß√µes Conclu√≠das**
- ‚úÖ API REST V4 operacional
- ‚úÖ RPA Python executando como www-data
- ‚úÖ Progress tracker em tempo real
- ‚úÖ Captura de estimativas funcionando
- ‚úÖ C√°lculo final funcionando
- ‚úÖ Logs sendo gravados corretamente
- ‚úÖ Permiss√µes configuradas
- ‚úÖ Browsers Playwright instalados

#### **Pr√≥ximos Passos**
1. **üîß Corre√ß√£o API Estimativas V6.3.0**: Corrigir API `get_progress.php` para retornar estimativas durante o processo (prioridade baixa)
2. **‚úÖ Interface HTML/Modal V6.1.0**: Desenvolvimento da nova vers√£o do modal para produ√ß√£o - **CONCLU√çDO**
3. **‚úÖ Corre√ß√£o Erros Formata√ß√£o V6.4.0**: Corre√ß√£o de vazamento de estilos CSS e seletores JavaScript incorretos - [Projeto Detalhado](PROJETO_CORRECAO_ERROS_FORMATACAO_V6.4.0.md) + [Teste Unit√°rio](teste-unitario-modal-v6.4.0.js) - **CONCLU√çDO**
4. **‚úÖ Melhorias Cosm√©ticas V6.7.5**: Ajustes visuais e de UX do modal (cores, espa√ßamentos, anima√ß√µes, responsividade, polimento final) - **CONCLU√çDO**
   - ‚úÖ Valor do seguro ao lado do t√≠tulo (alinhado √† direita)
   - ‚úÖ Bot√£o "Falar com Especialista" removido
   - ‚úÖ Espa√ßamento entre linhas reduzido em 20%
   - ‚úÖ Compress√£o vertical moderada do modal
   - ‚úÖ Margem inferior do results-container removida
   - ‚úÖ Bot√£o "Fechar" substitu√≠do por "X" quadrado azul escuro
   - ‚úÖ Frame preto e borda azul removidos
   - ‚úÖ Gap entre progress-bar-wrapper e modal-content eliminado
   - ‚úÖ Margin-bottom dos result-card removido
   - ‚úÖ Sombra elegante com blur implementada
   - ‚ùå Centraliza√ß√£o vertical do results-container (removida - ficou ruim)
   - ‚úÖ T√≠tulos "Recomendado" e "Alternativo" com fonte maior (mesmo tamanho dos valores)
   - ‚úÖ **VERS√ÉO VISUAL FINAL PARA PRODU√á√ÉO**
5. **üìù Revis√£o Mensagens RPA V6.7.0 (Tela falhou)**: Revisar e modificar mensagens do RPA onde s√£o citadas "Tela X falhou" para melhorar a experi√™ncia do usu√°rio
6. **üîç Valida√ß√£o tipo_veiculo**: Implementar valida√ß√£o de dom√≠nio para campo `tipo_veiculo` (aceitar apenas "carro" ou "moto", rejeitar "sedan", "hatch", etc.) nos m√≥dulos de valida√ß√£o do RPA
7. **üîê Valida√ß√£o HTTPS/SSL**: ‚úÖ **CONCLU√çDO** - HTTPS implementado e funcionando perfeitamente no servidor Hetzner (37.27.92.160), certificados SSL Let's Encrypt configurados, todas as refer√™ncias HTTP atualizadas para HTTPS
8. **üéØ Implementa√ß√£o Webhooks Webflow V6.8.0**: Implementar os 4 webhooks obrigat√≥rios no script JavaScript injetado no Webflow:
   - **Webhook 1**: `https://mdmidia.com.br/add_travelangels.php` - Webhook existente MDMIDIA
   - **Webhook 2**: `https://mdmidia.com.br/add_webflow_octa.php` - Webhook existente MDMIDIA
   - **Webhook 3**: `POST /api/rpa/start` - Criar sess√£o RPA e iniciar processo
   - **Webhook 4**: `GET /api/rpa/progress/{session_id}` - Monitorar progresso em tempo real
   - **Configura√ß√£o**: Event listener no bot√£o "Calcular agora" do formul√°rio Webflow
   - **Fluxo**: Coletar dados do formul√°rio ‚Üí Disparar webhooks 1&2 (MDMIDIA) ‚Üí Disparar webhook 3 (RPA) ‚Üí Monitorar com webhook 4 ‚Üí Exibir resultados
   - **Compatibilidade**: Garantir que os webhooks existentes continuem funcionando com o padr√£o de par√¢metros do Webflow
9. **Sistema de Backups**: Implementar backups incrementais em nuvem (Amazon S3) - [Plano Completo](PLANO_BACKUPS_NUVEM_V6.md)
10. **Testes de Carga**: Valida√ß√£o com m√∫ltiplos usu√°rios simult√¢neos
11. **Monitoramento**: Sistema de alertas para falhas

---

## ü§ù **CONTRIBUI√á√ÉO**

### **Como Contribuir**
1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

### **Padr√µes de C√≥digo**
- Use Python 3.8+
- Siga PEP 8
- Documente fun√ß√µes e classes
- Adicione testes para novas funcionalidades

---

## üìÑ **LICEN√áA**

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

---

## üë®‚Äçüíª **AUTOR**

**Luciano Otero**
- Email: luciano@imediatoseguros.com.br
- LinkedIn: [Luciano Otero](https://www.linkedin.com/in/luciano-otero)
- GitHub: [@LucianoOtero](https://github.com/LucianoOtero)

---

## üìû **SUPORTE**

### **Canais de Suporte**
- üìß Email: suporte@imediatoseguros.com.br
- üì± WhatsApp: (11) 99999-9999
- üí¨ Issues: [GitHub Issues](https://github.com/LucianoOtero/imediatoseguros-rpa-playright/issues)

### **Documenta√ß√£o Adicional**
- üìñ [Documenta√ß√£o Completa](docs/DOCUMENTACAO_COMPLETA_MIGRACAO.md)
- üìã [Controle de Vers√£o](docs/CONTROLE_VERSAO.md)
- üîß [Componentes Pendentes](docs/COMPONENTES_AUSENTES.md)

### **üìã Documenta√ß√£o V6.2.2**
- üèóÔ∏è [Arquitetura Solu√ß√£o RPA V6.0.0](ARQUITETURA_SOLUCAO_RPA_V6.md) - Documenta√ß√£o t√©cnica completa da vers√£o 6.0.0
- üíæ [Plano de Backups Nuvem V6.0.0](PLANO_BACKUPS_NUVEM_V6.md) - Sistema de backups incrementais em nuvem
- üÜï [Plano Desenvolvimento Modal V6.1.0](PLANO_DESENVOLVIMENTO_MODAL_V6.1.0.md) - Desenvolvimento da nova interface para produ√ß√£o
- üîß [Corre√ß√µes SessionService V6.0.0](CORRECOES_SESSIONSERVICE_V6.md) - Documenta√ß√£o das corre√ß√µes cr√≠ticas
- üöÄ [Script Inicializa√ß√£o Hetzner V6.0.0](SCRIPT_INICIALIZACAO_HETZNER_V6.md) - Script de recupera√ß√£o autom√°tica
- ‚úÖ [Modal Simplificado V6.2.2](MODAL_SIMPLIFICADO_V6.2.2.md) - Documenta√ß√£o da simplifica√ß√£o do modal
- üìä [Relat√≥rio Final V5.0.0](RELATORIO_FINAL_V5_ARQUITETURA_ATUAL.md) - Arquitetura atual dos sistemas
- üîß [Plano de Atualiza√ß√£o Modal RPA](PLANO_ATUALIZACAO_MODAL_RPA_V5.md) - Atualiza√ß√£o do modal_rpa_real.html
- üñ•Ô∏è [Fotografia Ambiente Hetzner](FOTOGRAFIA_AMBIENTE_HETZNER_V5.md) - Configura√ß√£o detalhada do servidor
- üèóÔ∏è [Arquitetura Solu√ß√£o RPA V4](ARQUITETURA_SOLUCAO_RPA_V4.md) - Documenta√ß√£o t√©cnica completa

---

**Status**: ‚úÖ **RPA V6.5.0 IMPLEMENTADA - FUNCIONALIDADE 100% COMPLETA**  
**√öltima Atualiza√ß√£o**: 06/10/2025  
**Pr√≥xima Vers√£o**: v6.6.0 - Melhorias Cosm√©ticas do Modal
