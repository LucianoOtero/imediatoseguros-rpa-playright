<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Correção Estimativa Inicial</title>
    <link rel="stylesheet" href="css/imediato-brand.css">
    <link rel="stylesheet" href="css/main-page.css">
    <link rel="stylesheet" href="css/modal-progress.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>🔧 Teste - Correção Estimativa Inicial</h1>
        
        <div class="test-section">
            <h2>✅ Correções Aplicadas</h2>
            <ul>
                <li>✅ Caminho corrigido: <code>progress.dados_extra.estimativas_tela_5</code></li>
                <li>✅ Função <code>updateInitialEstimate()</code> corrigida</li>
                <li>✅ Função <code>updateResults()</code> corrigida</li>
                <li>✅ Debug logs atualizados</li>
                <li>✅ Verificação de disponibilidade corrigida</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>🧪 Teste de Validação</h2>
            <button onclick="testarCorrecao()" class="btn-primary">
                <i class="fas fa-play"></i> Testar Correção
            </button>
            <div id="testResults" class="test-results"></div>
        </div>

        <div class="test-section">
            <h2>📊 Estrutura de Dados Esperada</h2>
            <pre><code>{
  "dados_extra": {
    "estimativas_tela_5": {
      "coberturas_detalhadas": [
        {
          "valores": {
            "de": "R$ 2.400,00",
            "ate": "R$ 2.900,00"
          }
        }
      ]
    }
  }
}</code></pre>
        </div>

        <div class="test-section">
            <h2>🔍 Logs de Debug</h2>
            <div id="debugLogs" class="debug-logs"></div>
        </div>
    </div>

    <script src="js/rpa-integration.js"></script>
    <script src="js/modal-progress.js"></script>
    <script src="js/main-page.js"></script>

    <script>
        function testarCorrecao() {
            const resultsDiv = document.getElementById('testResults');
            const logsDiv = document.getElementById('debugLogs');
            
            // Limpar logs anteriores
            logsDiv.innerHTML = '';
            
            // Simular dados do JSON real
            const mockData = {
                progress: {
                    dados_extra: {
                        estimativas_tela_5: {
                            coberturas_detalhadas: [
                                {
                                    valores: {
                                        de: "R$ 2.400,00",
                                        ate: "R$ 2.900,00"
                                    }
                                }
                            ]
                        }
                    }
                }
            };

            // Teste 1: Verificar se o caminho está correto
            const estimativas = mockData.progress?.dados_extra?.estimativas_tela_5;
            const coberturas = estimativas?.coberturas_detalhadas;
            const primeiraCobertura = coberturas?.[0];
            const valorInicial = primeiraCobertura?.valores?.de;

            let testResults = '<h3>🧪 Resultados dos Testes:</h3>';
            
            // Teste 1: Caminho correto
            if (estimativas) {
                testResults += '<p>✅ <strong>Teste 1:</strong> Caminho dados_extra.estimativas_tela_5 - OK</p>';
            } else {
                testResults += '<p>❌ <strong>Teste 1:</strong> Caminho dados_extra.estimativas_tela_5 - FALHOU</p>';
            }

            // Teste 2: Coberturas disponíveis
            if (coberturas && coberturas.length > 0) {
                testResults += '<p>✅ <strong>Teste 2:</strong> Coberturas detalhadas encontradas - OK</p>';
            } else {
                testResults += '<p>❌ <strong>Teste 2:</strong> Coberturas detalhadas - FALHOU</p>';
            }

            // Teste 3: Valor inicial
            if (valorInicial) {
                testResults += '<p>✅ <strong>Teste 3:</strong> Valor inicial extraído - OK</p>';
                testResults += `<p>💰 <strong>Valor encontrado:</strong> ${valorInicial}</p>`;
            } else {
                testResults += '<p>❌ <strong>Teste 3:</strong> Valor inicial - FALHOU</p>';
            }

            // Teste 4: Formatação de moeda
            if (window.ProgressModalRPA) {
                const modal = new ProgressModalRPA('test-session');
                const valorFormatado = modal.formatCurrency(valorInicial);
                testResults += `<p>✅ <strong>Teste 4:</strong> Formatação de moeda - OK</p>`;
                testResults += `<p>💰 <strong>Valor formatado:</strong> ${valorFormatado}</p>`;
            } else {
                testResults += '<p>❌ <strong>Teste 4:</strong> Classe ProgressModalRPA não encontrada</p>';
            }

            resultsDiv.innerHTML = testResults;

            // Logs de debug
            let debugLogs = '<h3>🔍 Logs de Debug:</h3>';
            debugLogs += '<pre>';
            debugLogs += `📊 Mock Data: ${JSON.stringify(mockData, null, 2)}\n`;
            debugLogs += `📊 Estimativas: ${JSON.stringify(estimativas, null, 2)}\n`;
            debugLogs += `📊 Coberturas: ${JSON.stringify(coberturas, null, 2)}\n`;
            debugLogs += `📊 Primeira Cobertura: ${JSON.stringify(primeiraCobertura, null, 2)}\n`;
            debugLogs += `📊 Valor Inicial: ${valorInicial}\n`;
            debugLogs += '</pre>';

            logsDiv.innerHTML = debugLogs;

            // Log no console também
            console.log('🧪 === TESTE DE CORREÇÃO ===');
            console.log('📊 Mock Data:', mockData);
            console.log('📊 Estimativas:', estimativas);
            console.log('📊 Coberturas:', coberturas);
            console.log('📊 Primeira Cobertura:', primeiraCobertura);
            console.log('📊 Valor Inicial:', valorInicial);
            console.log('🧪 === FIM DO TESTE ===');
        }

        // Log quando a página carregar
        window.addEventListener('load', function() {
            console.log('🔧 Página de teste carregada - Correção aplicada!');
            console.log('📊 Caminho correto: progress.dados_extra.estimativas_tela_5');
        });
    </script>

    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            font-family: 'Titillium Web', sans-serif;
        }

        .test-section {
            background: var(--imediato-white);
            border: 2px solid var(--imediato-light-blue);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .test-section h2 {
            color: var(--imediato-dark-blue);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .test-results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .debug-logs {
            background: #1e1e1e;
            color: #00ff00;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .btn-primary {
            background: var(--imediato-dark-blue);
            color: var(--imediato-white);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--imediato-light-blue);
            transform: translateY(-2px);
        }

        pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        li:last-child {
            border-bottom: none;
        }
    </style>
</body>
</html>


